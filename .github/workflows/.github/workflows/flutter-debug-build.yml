name: Flutter Debug & Build (Read-Only)

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main", "develop" ]
  workflow_dispatch:

jobs:
  flutter-debug-build:
    runs-on: ubuntu-latest

    env:
      FLUTTER_CHANNEL: stable

    steps:
      # 1Ô∏è‚É£ Checkout code (READ-ONLY)
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Setup Flutter
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: ${{ env.FLUTTER_CHANNEL }}

      # 3Ô∏è‚É£ Flutter & Dart versions
      - name: Show Flutter & Dart versions
        run: |
          flutter --version
          dart --version

      # 4Ô∏è‚É£ Dependency resolution
      - name: Flutter pub get (Dependency check)
        run: flutter pub get

      # 5Ô∏è‚É£ Static analysis (FULL ERROR DETAILS)
      - name: Flutter analyze (File + Line + Reason)
        run: |
          echo "========== FLUTTER ANALYZE =========="
          flutter analyze --no-fatal-warnings
        continue-on-error: true

      # 6Ô∏è‚É£ Format check (NO AUTO-FIX)
      - name: Dart format check (read-only)
        run: |
          echo "========== FORMAT CHECK =========="
          dart format --output=none --set-exit-if-changed .
        continue-on-error: true

      # 7Ô∏è‚É£ Unit / Widget tests (if exist)
      - name: Run Flutter tests
        run: |
          echo "========== TESTS =========="
          flutter test
        continue-on-error: true

      # 8Ô∏è‚É£ Build APK (REAL BUILD)
      - name: Build APK (Debug)
        run: |
          echo "========== BUILD APK =========="
          flutter build apk --debug
        continue-on-error: true

      # 9Ô∏è‚É£ Build AppBundle (Release simulation)
      - name: Build AppBundle (Release)
        run: |
          echo "========== BUILD APPBUNDLE =========="
          flutter build appbundle --release
        continue-on-error: true

      # üîü Summary
      - name: Debug summary
        run: |
          echo "===================================="
          echo "Workflow finished."
          echo "Check logs above for:"
          echo "- File names"
          echo "- Line numbers"
          echo "- Error types"
          echo "===================================="
